➜  v git:(main) ✗ ./run-mnist.sh
=== VERSION INFORMATION ===
Python version: Python 3.12.3
Pip version: pip 25.2 from /usr/local/lib/python3.12/dist-packages/pip (python 3.12)

=== JAX Information ===
JAX version: 0.4.35
JAXLib version: 0.4.35

=== NCCL Information ===
NCCL version: 2.27.7-1+cuda13.0
CUDA version: 13.0,

=== TPU Information ===
Jax plugin configuration error: Exception when calling jax_plugins.xla_cuda13.initialize()
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/jax/_src/xla_bridge.py", line 610, in discover_pjrt_plugins
    plugin_module.initialize()
  File "/opt/jaxlibs/jax_cuda13_pjrt/jax_plugins/xla_cuda13/__init__.py", line 328, in initialize
    _check_cuda_versions(raise_on_first_error=True)
  File "/opt/jaxlibs/jax_cuda13_pjrt/jax_plugins/xla_cuda13/__init__.py", line 285, in _check_cuda_versions
    local_device_count = cuda_versions.cuda_device_count()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: jaxlib/cuda/versions_helpers.cc:113: operation cuInit(0) failed: Unknown CUDA error 303; cuGetErrorName failed. This probably means that JAX was unable to load the CUDA libraries.
No TPU devices found

=== Gloo Information ===
Gloo: Built from source (commit 43b7acbf372cdce14075f3526e39153b7e433b53)
Gloo library: Found at /usr/local/lib/libgloo.so

=== Installed Python Packages ===
Package                 Version                         Editable project location
----------------------- ------------------------------- ----------------------------------------
absl-py                 2.3.1
aiofiles                24.1.0
annotated-types         0.7.0
asttokens               3.0.0
build                   1.3.0
cachetools              5.5.2
certifi                 2025.8.3
charset-normalizer      3.4.3
chex                    0.1.90
click                   8.2.1
decorator               5.2.1
durationpy              0.10
etils                   1.13.0
executing               2.2.0
flax                    0.11.1                          /opt/flax
fsspec                  2025.7.0
google-auth             2.40.3
humanize                4.13.0
idna                    3.10
importlib_metadata      8.7.0
importlib_resources     6.5.2
ipython                 9.4.0
ipython_pygments_lexers 1.1.1
jax                     0.4.35
jax-cuda13-pjrt         0.7.2.dev20250828               /opt/jaxlibs/jax_cuda13_pjrt
jax-cuda13-plugin       0.7.2.dev20250828               /opt/jaxlibs/jax_cuda13_plugin
jaxlib                  0.4.35
jedi                    0.19.2
kubernetes              33.1.0
libtpu                  0.0.2
libtpu_nightly          0.1.dev20241010+nightly.cleanup
markdown-it-py          4.0.0
matplotlib-inline       0.1.7
mdurl                   0.1.2
ml_dtypes               0.5.3
msgpack                 1.1.1
nest-asyncio            1.6.0
nsys-jax                0.1.dev1203+g5aca44eb3          /opt/nsys-jax/.github/container/nsys_jax
numpy                   2.3.2
oauthlib                3.3.1
opt_einsum              3.4.0
optax                   0.2.5
orbax-checkpoint        0.11.23
packaging               25.0
pandas                  2.3.2
parso                   0.8.5
pexpect                 4.9.0
pip                     25.2
pip-tools               7.4.1
prettytable             3.16.0
prompt_toolkit          3.0.52
protobuf                6.32.0
psutil                  7.0.0
ptyprocess              0.7.0
pure_eval               0.2.3
pyarrow                 21.0.0
pyasn1                  0.6.1
pyasn1_modules          0.4.2
pydantic                2.11.7
pydantic_core           2.33.2
Pygments                2.19.2
pyproject_hooks         1.2.0
python-dateutil         2.9.0.post0
pytz                    2025.2
PyYAML                  6.0.2
requests                2.32.5
requests-oauthlib       2.0.0
rich                    14.1.0
rsa                     4.9.1
scipy                   1.16.1
setuptools              80.9.0
simplejson              3.20.1
six                     1.17.0
stack-data              0.6.3
tensorstore             0.1.76
toolz                   1.0.0
traitlets               5.14.3
transformer_engine      2.8.0.dev0+c7761419
treescope               0.1.10
typing_extensions       4.15.0
typing-inspection       0.4.1
tzdata                  2025.2
uncertainties           3.2.3
urllib3                 2.5.0
wcwidth                 0.2.13
websocket-client        1.8.0
wheel                   0.45.1
zipp                    3.23.0
Collecting torch
  Downloading torch-2.8.0-cp312-cp312-manylinux_2_28_aarch64.whl.metadata (30 kB)
Collecting torchvision
  Downloading torchvision-0.23.0-cp312-cp312-manylinux_2_28_aarch64.whl.metadata (6.1 kB)
Collecting filelock (from torch)
  Downloading filelock-3.19.1-py3-none-any.whl.metadata (2.1 kB)
Requirement already satisfied: typing-extensions>=4.10.0 in /usr/local/lib/python3.12/dist-packages (from torch) (4.15.0)
Requirement already satisfied: setuptools in /usr/local/lib/python3.12/dist-packages (from torch) (80.9.0)
Collecting sympy>=1.13.3 (from torch)
  Downloading sympy-1.14.0-py3-none-any.whl.metadata (12 kB)
Collecting networkx (from torch)
  Downloading networkx-3.5-py3-none-any.whl.metadata (6.3 kB)
Collecting jinja2 (from torch)
  Downloading jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
Requirement already satisfied: fsspec in /usr/local/lib/python3.12/dist-packages (from torch) (2025.7.0)
Requirement already satisfied: numpy in /usr/local/lib/python3.12/dist-packages (from torchvision) (2.3.2)
Collecting pillow!=8.3.*,>=5.3.0 (from torchvision)
  Downloading pillow-11.3.0-cp312-cp312-manylinux_2_27_aarch64.manylinux_2_28_aarch64.whl.metadata (9.0 kB)
Collecting mpmath<1.4,>=1.1.0 (from sympy>=1.13.3->torch)
  Downloading mpmath-1.3.0-py3-none-any.whl.metadata (8.6 kB)
Collecting MarkupSafe>=2.0 (from jinja2->torch)
  Downloading MarkupSafe-3.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl.metadata (4.0 kB)
Downloading torch-2.8.0-cp312-cp312-manylinux_2_28_aarch64.whl (101.9 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 101.9/101.9 MB 13.8 MB/s  0:00:07
Downloading torchvision-0.23.0-cp312-cp312-manylinux_2_28_aarch64.whl (2.4 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.4/2.4 MB 16.4 MB/s  0:00:00
Downloading pillow-11.3.0-cp312-cp312-manylinux_2_27_aarch64.manylinux_2_28_aarch64.whl (6.0 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.0/6.0 MB 15.0 MB/s  0:00:00
Downloading sympy-1.14.0-py3-none-any.whl (6.3 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.3/6.3 MB 16.3 MB/s  0:00:00
Downloading mpmath-1.3.0-py3-none-any.whl (536 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 536.2/536.2 kB 11.1 MB/s  0:00:00
Downloading filelock-3.19.1-py3-none-any.whl (15 kB)
Downloading jinja2-3.1.6-py3-none-any.whl (134 kB)
Downloading MarkupSafe-3.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl (24 kB)
Downloading networkx-3.5-py3-none-any.whl (2.0 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.0/2.0 MB 15.8 MB/s  0:00:00
Installing collected packages: mpmath, sympy, pillow, networkx, MarkupSafe, filelock, jinja2, torch, torchvision
Successfully installed MarkupSafe-3.0.2 filelock-3.19.1 jinja2-3.1.6 mpmath-1.3.0 networkx-3.5 pillow-11.3.0 sympy-1.14.0 torch-2.8.0 torchvision-0.23.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
Traceback (most recent call last):
  File "/workspace/mnist.py", line 213, in <module>
    jax.distributed.initialize()
  File "/usr/local/lib/python3.12/dist-packages/jax/_src/distributed.py", line 231, in initialize
    global_state.initialize(coordinator_address, num_processes, process_id,
  File "/usr/local/lib/python3.12/dist-packages/jax/_src/distributed.py", line 66, in initialize
    raise ValueError('coordinator_address should be defined.')
ValueError: coordinator_address should be defined.
➜  v git:(main) ✗ ./run-mnist.sh
=== VERSION INFORMATION ===
Python version: Python 3.12.3
Pip version: pip 25.2 from /usr/local/lib/python3.12/dist-packages/pip (python 3.12)

=== JAX Information ===
JAX version: 0.4.35
JAXLib version: 0.4.35

=== NCCL Information ===
NCCL version: 2.27.7-1+cuda13.0
CUDA version: 13.0,

=== TPU Information ===
Jax plugin configuration error: Exception when calling jax_plugins.xla_cuda13.initialize()
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/jax/_src/xla_bridge.py", line 610, in discover_pjrt_plugins
    plugin_module.initialize()
  File "/opt/jaxlibs/jax_cuda13_pjrt/jax_plugins/xla_cuda13/__init__.py", line 328, in initialize
    _check_cuda_versions(raise_on_first_error=True)
  File "/opt/jaxlibs/jax_cuda13_pjrt/jax_plugins/xla_cuda13/__init__.py", line 285, in _check_cuda_versions
    local_device_count = cuda_versions.cuda_device_count()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: jaxlib/cuda/versions_helpers.cc:113: operation cuInit(0) failed: Unknown CUDA error 303; cuGetErrorName failed. This probably means that JAX was unable to load the CUDA libraries.
No TPU devices found

=== Gloo Information ===
Gloo: Built from source (commit 43b7acbf372cdce14075f3526e39153b7e433b53)
Gloo library: Found at /usr/local/lib/libgloo.so

=== Installed Python Packages ===
Package                 Version                         Editable project location
----------------------- ------------------------------- ----------------------------------------
absl-py                 2.3.1
aiofiles                24.1.0
annotated-types         0.7.0
asttokens               3.0.0
build                   1.3.0
cachetools              5.5.2
certifi                 2025.8.3
charset-normalizer      3.4.3
chex                    0.1.90
click                   8.2.1
decorator               5.2.1
durationpy              0.10
etils                   1.13.0
executing               2.2.0
flax                    0.11.1                          /opt/flax
fsspec                  2025.7.0
google-auth             2.40.3
humanize                4.13.0
idna                    3.10
importlib_metadata      8.7.0
importlib_resources     6.5.2
ipython                 9.4.0
ipython_pygments_lexers 1.1.1
jax                     0.4.35
jax-cuda13-pjrt         0.7.2.dev20250828               /opt/jaxlibs/jax_cuda13_pjrt
jax-cuda13-plugin       0.7.2.dev20250828               /opt/jaxlibs/jax_cuda13_plugin
jaxlib                  0.4.35
jedi                    0.19.2
kubernetes              33.1.0
libtpu                  0.0.2
libtpu_nightly          0.1.dev20241010+nightly.cleanup
markdown-it-py          4.0.0
matplotlib-inline       0.1.7
mdurl                   0.1.2
ml_dtypes               0.5.3
msgpack                 1.1.1
nest-asyncio            1.6.0
nsys-jax                0.1.dev1203+g5aca44eb3          /opt/nsys-jax/.github/container/nsys_jax
numpy                   2.3.2
oauthlib                3.3.1
opt_einsum              3.4.0
optax                   0.2.5
orbax-checkpoint        0.11.23
packaging               25.0
pandas                  2.3.2
parso                   0.8.5
pexpect                 4.9.0
pip                     25.2
pip-tools               7.4.1
prettytable             3.16.0
prompt_toolkit          3.0.52
protobuf                6.32.0
psutil                  7.0.0
ptyprocess              0.7.0
pure_eval               0.2.3
pyarrow                 21.0.0
pyasn1                  0.6.1
pyasn1_modules          0.4.2
pydantic                2.11.7
pydantic_core           2.33.2
Pygments                2.19.2
pyproject_hooks         1.2.0
python-dateutil         2.9.0.post0
pytz                    2025.2
PyYAML                  6.0.2
requests                2.32.5
requests-oauthlib       2.0.0
rich                    14.1.0
rsa                     4.9.1
scipy                   1.16.1
setuptools              80.9.0
simplejson              3.20.1
six                     1.17.0
stack-data              0.6.3
tensorstore             0.1.76
toolz                   1.0.0
traitlets               5.14.3
transformer_engine      2.8.0.dev0+c7761419
treescope               0.1.10
typing_extensions       4.15.0
typing-inspection       0.4.1
tzdata                  2025.2
uncertainties           3.2.3
urllib3                 2.5.0
wcwidth                 0.2.13
websocket-client        1.8.0
wheel                   0.45.1
zipp                    3.23.0
Collecting torch
  Downloading torch-2.8.0-cp312-cp312-manylinux_2_28_aarch64.whl.metadata (30 kB)
Collecting torchvision
  Downloading torchvision-0.23.0-cp312-cp312-manylinux_2_28_aarch64.whl.metadata (6.1 kB)
Collecting filelock (from torch)
  Downloading filelock-3.19.1-py3-none-any.whl.metadata (2.1 kB)
Requirement already satisfied: typing-extensions>=4.10.0 in /usr/local/lib/python3.12/dist-packages (from torch) (4.15.0)
Requirement already satisfied: setuptools in /usr/local/lib/python3.12/dist-packages (from torch) (80.9.0)
Collecting sympy>=1.13.3 (from torch)
  Downloading sympy-1.14.0-py3-none-any.whl.metadata (12 kB)
Collecting networkx (from torch)
  Downloading networkx-3.5-py3-none-any.whl.metadata (6.3 kB)
Collecting jinja2 (from torch)
  Downloading jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
Requirement already satisfied: fsspec in /usr/local/lib/python3.12/dist-packages (from torch) (2025.7.0)
Requirement already satisfied: numpy in /usr/local/lib/python3.12/dist-packages (from torchvision) (2.3.2)
Collecting pillow!=8.3.*,>=5.3.0 (from torchvision)
  Downloading pillow-11.3.0-cp312-cp312-manylinux_2_27_aarch64.manylinux_2_28_aarch64.whl.metadata (9.0 kB)
Collecting mpmath<1.4,>=1.1.0 (from sympy>=1.13.3->torch)
  Downloading mpmath-1.3.0-py3-none-any.whl.metadata (8.6 kB)
Collecting MarkupSafe>=2.0 (from jinja2->torch)
  Downloading MarkupSafe-3.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl.metadata (4.0 kB)
Downloading torch-2.8.0-cp312-cp312-manylinux_2_28_aarch64.whl (101.9 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 101.9/101.9 MB 13.5 MB/s  0:00:07
Downloading torchvision-0.23.0-cp312-cp312-manylinux_2_28_aarch64.whl (2.4 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.4/2.4 MB 4.0 MB/s  0:00:00
Downloading pillow-11.3.0-cp312-cp312-manylinux_2_27_aarch64.manylinux_2_28_aarch64.whl (6.0 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.0/6.0 MB 19.2 MB/s  0:00:00
Downloading sympy-1.14.0-py3-none-any.whl (6.3 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.3/6.3 MB 16.2 MB/s  0:00:00
Downloading mpmath-1.3.0-py3-none-any.whl (536 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 536.2/536.2 kB 15.0 MB/s  0:00:00
Downloading filelock-3.19.1-py3-none-any.whl (15 kB)
Downloading jinja2-3.1.6-py3-none-any.whl (134 kB)
Downloading MarkupSafe-3.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl (24 kB)
Downloading networkx-3.5-py3-none-any.whl (2.0 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.0/2.0 MB 18.4 MB/s  0:00:00
Installing collected packages: mpmath, sympy, pillow, networkx, MarkupSafe, filelock, jinja2, torch, torchvision
Successfully installed MarkupSafe-3.0.2 filelock-3.19.1 jinja2-3.1.6 mpmath-1.3.0 networkx-3.5 pillow-11.3.0 sympy-1.14.0 torch-2.8.0 torchvision-0.23.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
Initializing training with emulated devices...
Jax plugin configuration error: Exception when calling jax_plugins.xla_cuda13.initialize()
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/jax/_src/xla_bridge.py", line 610, in discover_pjrt_plugins
    plugin_module.initialize()
  File "/opt/jaxlibs/jax_cuda13_pjrt/jax_plugins/xla_cuda13/__init__.py", line 328, in initialize
    _check_cuda_versions(raise_on_first_error=True)
  File "/opt/jaxlibs/jax_cuda13_pjrt/jax_plugins/xla_cuda13/__init__.py", line 285, in _check_cuda_versions
    local_device_count = cuda_versions.cuda_device_count()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: jaxlib/cuda/versions_helpers.cc:113: operation cuInit(0) failed: Unknown CUDA error 303; cuGetErrorName failed. This probably means that JAX was unable to load the CUDA libraries.
100.0%
100.0%
100.0%
100.0%
Number of emulated devices: 4
Traceback (most recent call last):
  File "/workspace/mnist.py", line 185, in <module>
    main()
  File "/workspace/mnist.py", line 138, in main
    state, metrics = p_train_step(state, split_batch)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/mnist.py", line 44, in train_step
    (_, logits), grads = grad_fn(state.params)
                         ^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/mnist.py", line 39, in loss_fn
    logits = state.apply_fn(params, batch["image"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/mnist.py", line 18, in __call__
    x = nn.Dense(features=512)(x)
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/flax/flax/linen/linear.py", line 263, in __call__
    kernel = self.param(
             ^^^^^^^^^^^
flax.errors.ScopeCollectionNotFound: Tried to access "kernel" from collection "params" in "/Dense_0" but the collection is empty. (https://flax.readthedocs.io/en/latest/api_reference/flax.errors.html#flax.errors.ScopeCollectionNotFound)
--------------------
For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
➜  v git:(main) ✗